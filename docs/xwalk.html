<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Crosswalk | Health Metrics Toolbox</title>
  <meta name="description" content="A guide to statistical tools developed by IHME’s Math Sciences team, led by Aleksandr Aravkin and Peng Zheng" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Crosswalk | Health Metrics Toolbox" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide to statistical tools developed by IHME’s Math Sciences team, led by Aleksandr Aravkin and Peng Zheng" />
  <meta name="github-repo" content="rsoren/health_metrics_toolbox" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Crosswalk | Health Metrics Toolbox" />
  
  <meta name="twitter:description" content="A guide to statistical tools developed by IHME’s Math Sciences team, led by Aleksandr Aravkin and Peng Zheng" />
  

<meta name="author" content="Maintained by Reed Sorensen (rsoren@uw.edu)" />


<meta name="date" content="2021-07-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mrbrt.html"/>

<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Health Metrics Toolbox</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="quickstart.html"><a href="quickstart.html"><i class="fa fa-check"></i><b>2</b> Quick start</a></li>
<li class="chapter" data-level="3" data-path="mrbrt.html"><a href="mrbrt.html"><i class="fa fa-check"></i><b>3</b> MR-BRT</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mrbrt.html"><a href="mrbrt.html#prep_data"><i class="fa fa-check"></i><b>3.1</b> Prepare simulated data</a></li>
<li class="chapter" data-level="3.2" data-path="mrbrt.html"><a href="mrbrt.html#section1"><i class="fa fa-check"></i><b>3.2</b> Fitting a standard mixed effects model</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mrbrt.html"><a href="mrbrt.html#section1_1"><i class="fa fa-check"></i><b>3.2.1</b> – Point prediction only</a></li>
<li class="chapter" data-level="3.2.2" data-path="mrbrt.html"><a href="mrbrt.html#section1_2"><i class="fa fa-check"></i><b>3.2.2</b> – Uncertainty from fixed effects only</a></li>
<li class="chapter" data-level="3.2.3" data-path="mrbrt.html"><a href="mrbrt.html#section1_3"><i class="fa fa-check"></i><b>3.2.3</b> – Uncertainty from fixed effects and between-study heterogeneity</a></li>
<li class="chapter" data-level="3.2.4" data-path="mrbrt.html"><a href="mrbrt.html#section1_4"><i class="fa fa-check"></i><b>3.2.4</b> – Predicting out on the random effects</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mrbrt.html"><a href="mrbrt.html#section2"><i class="fa fa-check"></i><b>3.3</b> Priors</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="mrbrt.html"><a href="mrbrt.html#section2_2"><i class="fa fa-check"></i><b>3.3.1</b> - Setting a prior on beta</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="mrbrt.html"><a href="mrbrt.html#section3"><i class="fa fa-check"></i><b>3.4</b> Removing the effects of outliers with trimming</a></li>
<li class="chapter" data-level="3.5" data-path="mrbrt.html"><a href="mrbrt.html#section4"><i class="fa fa-check"></i><b>3.5</b> Splines</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="mrbrt.html"><a href="mrbrt.html#section4_1"><i class="fa fa-check"></i><b>3.5.1</b> - Setting priors and shape constraints on splines</a></li>
<li class="chapter" data-level="3.5.2" data-path="mrbrt.html"><a href="mrbrt.html#section4_2"><i class="fa fa-check"></i><b>3.5.2</b> - Ensemble splines</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="mrbrt.html"><a href="mrbrt.html#section5"><i class="fa fa-check"></i><b>3.6</b> The ratio model</a></li>
<li class="chapter" data-level="3.7" data-path="mrbrt.html"><a href="mrbrt.html#section6"><i class="fa fa-check"></i><b>3.7</b> Automated covariate selection</a></li>
<li class="chapter" data-level="3.8" data-path="mrbrt.html"><a href="mrbrt.html#section7"><i class="fa fa-check"></i><b>3.8</b> Calculating an evidence score</a></li>
<li class="chapter" data-level="3.9" data-path="mrbrt.html"><a href="mrbrt.html#section8"><i class="fa fa-check"></i><b>3.9</b> Visualizing evidence score results</a></li>
<li class="chapter" data-level="3.10" data-path="mrbrt.html"><a href="mrbrt.html#section9"><i class="fa fa-check"></i><b>3.10</b> Frequently asked questions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="xwalk.html"><a href="xwalk.html"><i class="fa fa-check"></i><b>4</b> Crosswalk</a>
<ul>
<li class="chapter" data-level="4.1" data-path="xwalk.html"><a href="xwalk.html#ex1"><i class="fa fa-check"></i><b>4.1</b> Example 1: one reference and one alternative</a></li>
<li class="chapter" data-level="4.2" data-path="xwalk.html"><a href="xwalk.html#ex2"><i class="fa fa-check"></i><b>4.2</b> Example 2: one reference and multiple alternatives, with indirect comparisons</a></li>
<li class="chapter" data-level="4.3" data-path="xwalk.html"><a href="xwalk.html#ex3"><i class="fa fa-check"></i><b>4.3</b> Example 3: one reference and multiple alternatives; alternatives composed of sub-definitions</a></li>
<li class="chapter" data-level="4.4" data-path="xwalk.html"><a href="xwalk.html#ex4"><i class="fa fa-check"></i><b>4.4</b> Funnel plots and dose-response plots</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Health Metrics Toolbox</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="xwalk" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Crosswalk</h1>
<p><a href="xwalk.html#ex1">Example 1, basic crosswalk</a></p>
<p><a href="xwalk.html#ex2">Example 2, network meta-analysis</a></p>
<p><a href="xwalk.html#ex3">Example 3, network meta-analysis with composite groups</a></p>
<p><a href="xwalk.html#ex4">Funnel plots and dose-response plots</a></p>
<hr />
<p>Crosswalking is the process of taking systematically biased data points and estimating their unbiased value. For example, when estimating overweight prevalence (BMI &gt;= 25), some height and weight observations might be measured physically while others are self-reported. Because people tend to overreport their height and underreport their weight, self-reported BMI is systematically biased downward. Crosswalking involves:</p>
<ol style="list-style-type: decimal">
<li>Finding pairs of alternative and reference (e.g. self-reported and measured) observations that match on relevant criteria (e.g. age, sex and location),</li>
<li>Taking the difference between these observations in log or logit space, to ensure that the crosswalk adjustment remains bounded correctly,</li>
<li>Running a meta-regression model that estimates how this difference varies by covariate values (e.g. age, sex and location); and</li>
<li>Predicting how much the alternative data points in the original dataset should be adjusted.</li>
</ol>
<p>To appropriately downweight the adjusted data point, we add uncertainty that comes from crosswalking process itself – standard error of the prediction and between-group heterogeneity – to the standard error of the result.</p>
<p>Sometimes a crosswalk needs to adjust multiple alternative definitions to the gold standard reference. For example, prevalence of schistosomiasis might be measured according to a gold standard diagnostic method A, or three alternatives B, C or D. The process is essentially the same as described above, with the added benefit that <em>network meta-analysis</em> can use information from the indirect comparisons B:C, C:D and B:D. This vignette demonstrates how to use the <code>crosswalk</code> package to run a meta-regression (optionally network meta-regression) to predict adjustment factors for biased observations.</p>
<div id="ex1" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Example 1: one reference and one alternative</h2>
<p>First, we create some simulated data for a crosswalk with one reference and one alternative. In <code>df_matched</code>, the variable <code>logit_diff</code> represents <code>logit(prev_alt) - logit(prev_ref)</code>, or the difference in logit-transformed prevalence values. By convention, we always subtract the reference from the alternative value, alt minus ref. <code>logit_diff_se</code> is the standard error of <code>logit_diff</code>. The package includes the functions <code>crosswalk::delta_transform()</code> and <code>crosswalk::calculate_diff()</code> to facilitate calculating these quantities from your matched data. See <a href="https://rpubs.com/rsoren/572599" class="uri">https://rpubs.com/rsoren/572599</a> for a full example.</p>
<p>We also simulate the original dataset containing observations to be adjusted (<code>df_orig</code>). The covariates used in the meta-regression model must exist in the original data, with the same column names (<code>x1</code> and <code>x2</code> in this case). We also include a column that indicates the definition/method used to obtain the observation: <code>obs_method</code> with values “selfreported” and “measured” in this case. For <code>df_orig</code>, we leave the dependent variable in linear space; the conversion to log or logit space is handled automatically by the <code>adjust_orig_vals()</code> function later.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="xwalk.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(crosswalk, lib.loc = &quot;/ihme/code/mscm/R/packages/&quot;) # for R version 3</span></span>
<span id="cb1-2"><a href="xwalk.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># detach(package:mrbrt002)</span></span>
<span id="cb1-3"><a href="xwalk.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crosswalk002, <span class="at">lib.loc =</span> <span class="st">&quot;/ihme/code/mscm/Rv4/packages/&quot;</span>) <span class="co"># for R version 4</span></span>
<span id="cb1-4"><a href="xwalk.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="xwalk.html#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="xwalk.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-7"><a href="xwalk.html#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="xwalk.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># data for the meta-regression</span></span>
<span id="cb1-9"><a href="xwalk.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># -- in a real analysis, you&#39;d get this dataset by </span></span>
<span id="cb1-10"><a href="xwalk.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    creating matched pairs of alternative/reference observations,</span></span>
<span id="cb1-11"><a href="xwalk.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    then using delta_transform() and calculate_diff() to get</span></span>
<span id="cb1-12"><a href="xwalk.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    log(alt)-log(ref) or logit(alt)-logit(ref) as your dependent variable</span></span>
<span id="cb1-13"><a href="xwalk.html#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="xwalk.html#cb1-14" aria-hidden="true" tabindex="-1"></a>beta0_true <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb1-15"><a href="xwalk.html#cb1-15" aria-hidden="true" tabindex="-1"></a>beta1_true <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-16"><a href="xwalk.html#cb1-16" aria-hidden="true" tabindex="-1"></a>beta2_true <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1-17"><a href="xwalk.html#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="xwalk.html#cb1-18" aria-hidden="true" tabindex="-1"></a>df_matched <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-19"><a href="xwalk.html#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">200</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">4</span>),</span>
<span id="cb1-20"><a href="xwalk.html#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="dv">200</span>, <span class="at">prob =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="xwalk.html#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-22"><a href="xwalk.html#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff =</span> beta0_true <span class="sc">+</span> x1<span class="sc">*</span>beta1_true <span class="sc">+</span> x2<span class="sc">*</span>beta2_true <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.)),</span>
<span id="cb1-23"><a href="xwalk.html#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff_se =</span> <span class="fu">runif</span>(<span class="dv">200</span>, <span class="at">min =</span> <span class="fl">0.9</span>, <span class="at">max =</span> <span class="fl">1.1</span>),</span>
<span id="cb1-24"><a href="xwalk.html#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">altvar =</span> <span class="st">&quot;selfreported&quot;</span>,</span>
<span id="cb1-25"><a href="xwalk.html#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">refvar =</span> <span class="st">&quot;measured&quot;</span>,</span>
<span id="cb1-26"><a href="xwalk.html#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">each =</span> <span class="dv">10</span>)</span>
<span id="cb1-27"><a href="xwalk.html#cb1-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-28"><a href="xwalk.html#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="xwalk.html#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_matched)</span>
<span id="cb1-30"><a href="xwalk.html#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         x1 x2 logit_diff logit_diff_se       altvar   refvar group_id</span></span>
<span id="cb1-31"><a href="xwalk.html#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1.150310  0  0.3491204     0.9941364 selfreported measured        1</span></span>
<span id="cb1-32"><a href="xwalk.html#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 3.153221  1  3.4656335     0.9731691 selfreported measured        1</span></span>
<span id="cb1-33"><a href="xwalk.html#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1.635908  1  0.3707626     0.9242544 selfreported measured        1</span></span>
<span id="cb1-34"><a href="xwalk.html#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 3.532070  1  3.0752637     0.9093987 selfreported measured        1</span></span>
<span id="cb1-35"><a href="xwalk.html#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 3.761869  0  0.3475292     0.9525593 selfreported measured        1</span></span>
<span id="cb1-36"><a href="xwalk.html#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0.182226  1 -1.2940209     1.0937282 selfreported measured        1</span></span>
<span id="cb1-37"><a href="xwalk.html#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="xwalk.html#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># original dataset with alternative observations to be adjusted</span></span>
<span id="cb1-39"><a href="xwalk.html#cb1-39" aria-hidden="true" tabindex="-1"></a>df_orig <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-40"><a href="xwalk.html#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">meanvar =</span> <span class="fu">runif</span>(<span class="dv">400</span>, <span class="at">min =</span> <span class="fl">0.2</span>, <span class="at">max =</span> <span class="fl">0.8</span>), <span class="co"># original prevalence values; between 0 and 1</span></span>
<span id="cb1-41"><a href="xwalk.html#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">sdvar =</span> <span class="fu">runif</span>(<span class="dv">400</span>, <span class="at">min =</span> <span class="fl">0.1</span>, <span class="at">max =</span> <span class="fl">0.5</span>), <span class="co"># standard errors of the original prevalence values; &gt;0</span></span>
<span id="cb1-42"><a href="xwalk.html#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="fu">runif</span>(<span class="dv">400</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">4</span>),</span>
<span id="cb1-43"><a href="xwalk.html#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">rbinom</span>(<span class="dv">400</span>, <span class="at">prob =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb1-44"><a href="xwalk.html#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_method =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;selfreported&quot;</span>, <span class="st">&quot;measured&quot;</span>), <span class="at">size =</span> <span class="dv">400</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-45"><a href="xwalk.html#cb1-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-46"><a href="xwalk.html#cb1-46" aria-hidden="true" tabindex="-1"></a>df_orig<span class="sc">$</span>row_id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;row&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_orig))</span>
<span id="cb1-47"><a href="xwalk.html#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="xwalk.html#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_orig)</span>
<span id="cb1-49"><a href="xwalk.html#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     meanvar     sdvar        x1 x2   obs_method row_id</span></span>
<span id="cb1-50"><a href="xwalk.html#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.3641736 0.1932959 0.6210565  1     measured   row1</span></span>
<span id="cb1-51"><a href="xwalk.html#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0.5563202 0.1922614 3.3834040  1     measured   row2</span></span>
<span id="cb1-52"><a href="xwalk.html#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.2961109 0.1246905 0.8575217  1 selfreported   row3</span></span>
<span id="cb1-53"><a href="xwalk.html#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0.7120581 0.2988474 2.6794930  0     measured   row4</span></span>
<span id="cb1-54"><a href="xwalk.html#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0.7086435 0.1976500 2.4710258  0 selfreported   row5</span></span>
<span id="cb1-55"><a href="xwalk.html#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0.4867321 0.4032742 0.1999991  1 selfreported   row6</span></span></code></pre></div>
<p>Next we use the <code>crosswalk</code> functions. <code>CWData()</code> prepares the data for meta-regression, and <code>CWModel()</code> fits the model. Inputs to the function parameters are described in the comments below, and more information is available in the R package help documentation. Some additional tips…</p>
<ul>
<li>When crosswalking one alternative to one reference definition/method, there will be only one value in each of the columns passed to <code>alt_dorms</code> and <code>ref_dorms</code> (e.g. “selfreported” and “measured,” respectively). This may seem like an unnecessary detail now, but it allows for simpler specification of a network meta-analysis within the same framework. More on that in Example 2.</li>
<li>The <code>cov_models</code> parameter takes a list of <code>CovModel()</code> function calls. These specify the functional form and/or constraints for each predictor in the model; see <code>help(CovModel)</code> for more information.</li>
<li>If you want a model with an intercept, you have to explicitly pass in <code>CovModel(cov_name = "intercept")</code> as an element of <code>cov_models = list(...)</code>. Note that for network meta-analysis, we almost always <em>do</em> want to include an “intercept,” which seems at odds with the guidance from GBD 2019. What changed is the definition of intercept, not the model. See the crosswalk training slides (<a href="https://rpubs.com/rsoren/572599" class="uri">https://rpubs.com/rsoren/572599</a>) for a mathematical explanation. Briefly, “intercepts” refer to what in GBD 2019 were the <span class="math inline">\({-1,0,1}\)</span> variables that encode the network structure. You no longer have to create these variables yourself, and instead only need to specify <code>CovModel("intercept")</code> in a network meta-analysis like the one in Example 2.</li>
<li>A continuous covariate can be represented as a spline with the <code>XSpline()</code> function. It takes arguments about polynomial degree, linearity in the tails and knot location (must include external knots at &lt;=min and &gt;= max values of the covariate). Relatedly, constraints on spline direction and shape may be specified in the <code>CovModel()</code> function with the <code>spline_monotonicity</code> and <code>spline_convexity</code> arguments. An example is commented out below.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="xwalk.html#cb2-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">CWData</span>(</span>
<span id="cb2-2"><a href="xwalk.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df_matched,          <span class="co"># dataset for metaregression</span></span>
<span id="cb2-3"><a href="xwalk.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs =</span> <span class="st">&quot;logit_diff&quot;</span>,       <span class="co"># column name for the observation mean</span></span>
<span id="cb2-4"><a href="xwalk.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_se =</span> <span class="st">&quot;logit_diff_se&quot;</span>, <span class="co"># column name for the observation standard error</span></span>
<span id="cb2-5"><a href="xwalk.html#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">alt_dorms =</span> <span class="st">&quot;altvar&quot;</span>,     <span class="co"># column name of the variable indicating the alternative method</span></span>
<span id="cb2-6"><a href="xwalk.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_dorms =</span> <span class="st">&quot;refvar&quot;</span>,     <span class="co"># column name of the variable indicating the reference method</span></span>
<span id="cb2-7"><a href="xwalk.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">covs =</span> <span class="fu">list</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>),     <span class="co"># names of columns to be used as covariates later</span></span>
<span id="cb2-8"><a href="xwalk.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">study_id =</span> <span class="st">&quot;group_id&quot;</span>,    <span class="co"># name of the column indicating group membership, usually the matching groups</span></span>
<span id="cb2-9"><a href="xwalk.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_intercept =</span> <span class="cn">TRUE</span>      <span class="co"># adds a column called &quot;intercept&quot; that may be used in CWModel()</span></span>
<span id="cb2-10"><a href="xwalk.html#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="xwalk.html#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="xwalk.html#cb2-12" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">CWModel</span>(</span>
<span id="cb2-13"><a href="xwalk.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwdata =</span> df1,            <span class="co"># object returned by `CWData()`</span></span>
<span id="cb2-14"><a href="xwalk.html#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_type =</span> <span class="st">&quot;diff_logit&quot;</span>, <span class="co"># &quot;diff_log&quot; or &quot;diff_logit&quot; depending on whether bounds are [0, Inf) or [0, 1]</span></span>
<span id="cb2-15"><a href="xwalk.html#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov_models =</span> <span class="fu">list</span>(       <span class="co"># specifying predictors in the model; see help(CovModel)</span></span>
<span id="cb2-16"><a href="xwalk.html#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CovModel</span>(<span class="at">cov_name =</span> <span class="st">&quot;intercept&quot;</span>),</span>
<span id="cb2-17"><a href="xwalk.html#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CovModel</span>(<span class="at">cov_name =</span> <span class="st">&quot;x1&quot;</span>),</span>
<span id="cb2-18"><a href="xwalk.html#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CovModel(cov_name = &quot;x1&quot;, spline = XSpline(knots = c(0,1,2,3,4), degree = 3L, l_linear = TRUE, r_linear = TRUE), spline_monotonicity = &quot;increasing&quot;),</span></span>
<span id="cb2-19"><a href="xwalk.html#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CovModel</span>(<span class="at">cov_name =</span> <span class="st">&quot;x2&quot;</span>) ),</span>
<span id="cb2-20"><a href="xwalk.html#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">gold_dorm =</span> <span class="st">&quot;measured&quot;</span>   <span class="co"># the level of `alt_dorms` that indicates it&#39;s the gold standard</span></span>
<span id="cb2-21"><a href="xwalk.html#cb2-21" aria-hidden="true" tabindex="-1"></a>                           <span class="co"># this will be useful when we can have multiple &quot;reference&quot; groups in NMA</span></span>
<span id="cb2-22"><a href="xwalk.html#cb2-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-23"><a href="xwalk.html#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="xwalk.html#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">data.frame</span>( <span class="co"># checking that the model recovers the true betas</span></span>
<span id="cb2-25"><a href="xwalk.html#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_true =</span> <span class="fu">c</span>(beta0_true, beta1_true, beta2_true), </span>
<span id="cb2-26"><a href="xwalk.html#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_mean =</span> fit1<span class="sc">$</span>beta[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb2-27"><a href="xwalk.html#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_se =</span> fit1<span class="sc">$</span>beta_sd[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb2-28"><a href="xwalk.html#cb2-28" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb2-29"><a href="xwalk.html#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   beta_true beta_mean   beta_se</span></span>
<span id="cb2-30"><a href="xwalk.html#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        -3 -3.164455 0.1628918</span></span>
<span id="cb2-31"><a href="xwalk.html#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         1  1.081816 0.0640169</span></span>
<span id="cb2-32"><a href="xwalk.html#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         2  2.076966 0.1412373</span></span></code></pre></div>
<p>To create a data frame with estimated coefficients, use <code>create_result_df()</code>. This is useful for saving coefficient summaries to CSV. To save a model object for future use, use <code>py_save_object()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="xwalk.html#cb3-1" aria-hidden="true" tabindex="-1"></a>df_result <span class="ot">&lt;-</span> fit1<span class="sc">$</span><span class="fu">create_result_df</span>()</span>
<span id="cb3-2"><a href="xwalk.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df_result, <span class="st">&quot;/home/j/temp/reed/misc/df_result_crosswalk.csv&quot;</span>)</span>
<span id="cb3-3"><a href="xwalk.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="xwalk.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">py_save_object</span>(<span class="at">object =</span> fit1, <span class="at">filename =</span> <span class="st">&quot;/home/j/temp/reed/misc/fit1.pkl&quot;</span>, <span class="at">pickle =</span> <span class="st">&quot;dill&quot;</span>)</span>
<span id="cb3-5"><a href="xwalk.html#cb3-5" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">py_load_object</span>(<span class="at">filename =</span> <span class="st">&quot;/home/j/temp/reed/misc/fit1.pkl&quot;</span>, <span class="at">pickle =</span> <span class="st">&quot;dill&quot;</span>)</span></code></pre></div>
<p>Finally, <code>adjust_orig_vals()</code> adjusts biased observations in the original dataset using the meta-regression model to predict the degree of bias. The <code>adjust_orig_vals()</code> function has a few requirements:</p>
<ul>
<li>While we manually calculated the log- or logit-scale differences for the meta-regression model, for <code>adjust_orig_vals()</code> we leave the parameter of interest in linear space.</li>
<li>For a log-scale crosswalk, <code>adjust_orig_vals()</code> cannot make adjustments for observations where the parameter value is zero. This happens because <code>log(0) = -Inf</code>. The same happens in logit-scale crosswalks with parameter values of 0 or 1, because <code>logit(0) = -Inf</code> and <code>logit(1) = Inf</code>. For this reason, <code>adjust_orig_vals()</code> will throw an error if the data frame includes observations exactly at the bound(s).</li>
<li>Variables used as predictors in the meta-regression model must also be present in dataset passed to <code>adjust_orig_vals()</code>, with the same column names.</li>
<li>The meta-regression model estimates a random effect for each group specified by the <code>study_id</code> variable. Whether you want to predict out on these random effects is a modeling decision that depends on whether you believe the random component captures true variation in the crosswalk adjustment, as opposed to noise in the data. As a default we leave the <code>adjust_orig_vals(..., study_id = NULL)</code> parameter unspecified and do not predict out on the random effects.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="xwalk.html#cb4-1" aria-hidden="true" tabindex="-1"></a>preds1 <span class="ot">&lt;-</span> <span class="fu">adjust_orig_vals</span>(</span>
<span id="cb4-2"><a href="xwalk.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit_object =</span> fit1, <span class="co"># object returned by `CWModel()`</span></span>
<span id="cb4-3"><a href="xwalk.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df_orig,</span>
<span id="cb4-4"><a href="xwalk.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_dorms =</span> <span class="st">&quot;obs_method&quot;</span>,</span>
<span id="cb4-5"><a href="xwalk.html#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_vals_mean =</span> <span class="st">&quot;meanvar&quot;</span>,</span>
<span id="cb4-6"><a href="xwalk.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_vals_se =</span> <span class="st">&quot;sdvar&quot;</span>,</span>
<span id="cb4-7"><a href="xwalk.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_id =</span> <span class="st">&quot;row_id&quot;</span>   <span class="co"># optional argument to add a user-defined ID to the predictions;</span></span>
<span id="cb4-8"><a href="xwalk.html#cb4-8" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># name of the column with the IDs</span></span>
<span id="cb4-9"><a href="xwalk.html#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-10"><a href="xwalk.html#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="xwalk.html#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="xwalk.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the result of adjust_orig_vals() is a five-element list,</span></span>
<span id="cb4-13"><a href="xwalk.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># vectors containing: </span></span>
<span id="cb4-14"><a href="xwalk.html#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># -- the adjusted mean and SE of the adjusted mean in linear space</span></span>
<span id="cb4-15"><a href="xwalk.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># -- the adjustment factor and SE of the adjustment factor in transformed space;</span></span>
<span id="cb4-16"><a href="xwalk.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#    note that the adjustment factor is the alt-ref prediction,</span></span>
<span id="cb4-17"><a href="xwalk.html#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#    so we *subtract* this value to make the adjustment</span></span>
<span id="cb4-18"><a href="xwalk.html#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># -- an identifier for the row of the prediction frame the corresponds to the prediction</span></span>
<span id="cb4-19"><a href="xwalk.html#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(preds1, head)</span>
<span id="cb4-20"><a href="xwalk.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ref_vals_mean</span></span>
<span id="cb4-21"><a href="xwalk.html#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.3641736 0.5563202 0.3304659 0.7120581 0.7990013 0.6938207</span></span>
<span id="cb4-22"><a href="xwalk.html#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-23"><a href="xwalk.html#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ref_vals_sd</span></span>
<span id="cb4-24"><a href="xwalk.html#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.1932959 0.1922614 0.1412219 0.2988474 0.1580049 0.3459730</span></span>
<span id="cb4-25"><a href="xwalk.html#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-26"><a href="xwalk.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $pred_diff_mean</span></span>
<span id="cb4-27"><a href="xwalk.html#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  0.0000000  0.0000000 -0.1598083  0.0000000 -0.4912590 -0.8711269</span></span>
<span id="cb4-28"><a href="xwalk.html#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-29"><a href="xwalk.html#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $pred_diff_sd</span></span>
<span id="cb4-30"><a href="xwalk.html#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.0000000 0.0000000 0.2224753 0.0000000 0.2270617 0.2159760</span></span>
<span id="cb4-31"><a href="xwalk.html#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-32"><a href="xwalk.html#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $data_id</span></span>
<span id="cb4-33"><a href="xwalk.html#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;row1&quot; &quot;row2&quot; &quot;row3&quot; &quot;row4&quot; &quot;row5&quot; &quot;row6&quot;</span></span>
<span id="cb4-34"><a href="xwalk.html#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="xwalk.html#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co"># now we add the adjusted values back to the original dataset</span></span>
<span id="cb4-36"><a href="xwalk.html#cb4-36" aria-hidden="true" tabindex="-1"></a>df_orig[, </span>
<span id="cb4-37"><a href="xwalk.html#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;meanvar_adjusted&quot;</span>, <span class="st">&quot;sdvar_adjusted&quot;</span>, </span>
<span id="cb4-38"><a href="xwalk.html#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;pred_logit&quot;</span>, <span class="st">&quot;pred_se_logit&quot;</span>, <span class="st">&quot;data_id&quot;</span>)] <span class="ot">&lt;-</span> preds1</span>
<span id="cb4-39"><a href="xwalk.html#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="xwalk.html#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># note that the gold standard observations remain untouched</span></span>
<span id="cb4-41"><a href="xwalk.html#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_orig)</span>
<span id="cb4-42"><a href="xwalk.html#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     meanvar     sdvar        x1 x2   obs_method row_id meanvar_adjusted</span></span>
<span id="cb4-43"><a href="xwalk.html#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.3641736 0.1932959 0.6210565  1     measured   row1        0.3641736</span></span>
<span id="cb4-44"><a href="xwalk.html#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0.5563202 0.1922614 3.3834040  1     measured   row2        0.5563202</span></span>
<span id="cb4-45"><a href="xwalk.html#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.2961109 0.1246905 0.8575217  1 selfreported   row3        0.3304659</span></span>
<span id="cb4-46"><a href="xwalk.html#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0.7120581 0.2988474 2.6794930  0     measured   row4        0.7120581</span></span>
<span id="cb4-47"><a href="xwalk.html#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0.7086435 0.1976500 2.4710258  0 selfreported   row5        0.7990013</span></span>
<span id="cb4-48"><a href="xwalk.html#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0.4867321 0.4032742 0.1999991  1 selfreported   row6        0.6938207</span></span>
<span id="cb4-49"><a href="xwalk.html#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   sdvar_adjusted pred_logit pred_se_logit data_id</span></span>
<span id="cb4-50"><a href="xwalk.html#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      0.1932959  0.0000000     0.0000000    row1</span></span>
<span id="cb4-51"><a href="xwalk.html#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      0.1922614  0.0000000     0.0000000    row2</span></span>
<span id="cb4-52"><a href="xwalk.html#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      0.1412219 -0.1598083     0.2224753    row3</span></span>
<span id="cb4-53"><a href="xwalk.html#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      0.2988474  0.0000000     0.0000000    row4</span></span>
<span id="cb4-54"><a href="xwalk.html#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      0.1580049 -0.4912590     0.2270617    row5</span></span>
<span id="cb4-55"><a href="xwalk.html#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      0.3459730 -0.8711269     0.2159760    row6</span></span></code></pre></div>
<p>To make sure we understand what’s going on, let’s manually calculate the adjustment for a particular row of the original dataset.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="xwalk.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_orig[<span class="dv">3</span>,]) <span class="co"># row 3 is a self-reported observation with prevalence 0.296</span></span>
<span id="cb5-2"><a href="xwalk.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     meanvar     sdvar        x1 x2   obs_method row_id meanvar_adjusted</span></span>
<span id="cb5-3"><a href="xwalk.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.2961109 0.1246905 0.8575217  1 selfreported   row3        0.3304659</span></span>
<span id="cb5-4"><a href="xwalk.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   sdvar_adjusted pred_logit pred_se_logit data_id</span></span>
<span id="cb5-5"><a href="xwalk.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      0.1412219 -0.1598083     0.2224753    row3</span></span>
<span id="cb5-6"><a href="xwalk.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="xwalk.html#cb5-7" aria-hidden="true" tabindex="-1"></a>fit1<span class="sc">$</span>fixed_vars <span class="co"># estimated betas</span></span>
<span id="cb5-8"><a href="xwalk.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $measured</span></span>
<span id="cb5-9"><a href="xwalk.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0 0 0</span></span>
<span id="cb5-10"><a href="xwalk.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-11"><a href="xwalk.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $selfreported</span></span>
<span id="cb5-12"><a href="xwalk.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -3.164455  1.081816  2.076966</span></span>
<span id="cb5-13"><a href="xwalk.html#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="xwalk.html#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># the predicted adjustment for an observations with x1=0.8575217 and x2=1 should be...</span></span>
<span id="cb5-15"><a href="xwalk.html#cb5-15" aria-hidden="true" tabindex="-1"></a>(pred <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.164455</span> <span class="sc">+</span> <span class="fl">1.081816</span><span class="sc">*</span><span class="fl">0.8575217</span> <span class="sc">+</span> <span class="fl">2.076966</span><span class="sc">*</span><span class="dv">1</span>)</span>
<span id="cb5-16"><a href="xwalk.html#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -0.1598083</span></span>
<span id="cb5-17"><a href="xwalk.html#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="xwalk.html#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># the prediction is defined as logit(alt) - logit(ref), so the final adjusted value should be</span></span>
<span id="cb5-19"><a href="xwalk.html#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># logit(mean_adjusted) = logit(mean_alt) - prediction</span></span>
<span id="cb5-20"><a href="xwalk.html#cb5-20" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">log</span>(p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p))</span>
<span id="cb5-21"><a href="xwalk.html#cb5-21" aria-hidden="true" tabindex="-1"></a>inv_logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(x)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x))</span>
<span id="cb5-22"><a href="xwalk.html#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="xwalk.html#cb5-23" aria-hidden="true" tabindex="-1"></a>logit_mean_adjusted <span class="ot">&lt;-</span> <span class="fu">logit</span>(df_orig[<span class="dv">3</span>, <span class="st">&quot;meanvar&quot;</span>]) <span class="sc">-</span> pred</span>
<span id="cb5-24"><a href="xwalk.html#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="fu">inv_logit</span>(logit_mean_adjusted)</span>
<span id="cb5-25"><a href="xwalk.html#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.3304659</span></span>
<span id="cb5-26"><a href="xwalk.html#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="xwalk.html#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># check that it&#39;s the same</span></span>
<span id="cb5-28"><a href="xwalk.html#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">inv_logit</span>(logit_mean_adjusted), <span class="at">digits =</span> <span class="dv">5</span>) <span class="sc">==</span> <span class="fu">round</span>(df_orig[<span class="dv">3</span>, <span class="st">&quot;meanvar_adjusted&quot;</span>], <span class="at">digits =</span> <span class="dv">5</span>)</span>
<span id="cb5-29"><a href="xwalk.html#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb5-30"><a href="xwalk.html#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="xwalk.html#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># SE of the adjusted data point is calculated as sqrt(a^2 + b^2 + c^2), where</span></span>
<span id="cb5-32"><a href="xwalk.html#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co"># a is the (log or logit) standard error of the original data point,</span></span>
<span id="cb5-33"><a href="xwalk.html#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># b is the standard error of the predicted adjustment</span></span>
<span id="cb5-34"><a href="xwalk.html#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># c is the standard deviation of between-group heterogeneity, a.k.a. sqrt(gamma)</span></span>
<span id="cb5-35"><a href="xwalk.html#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-36"><a href="xwalk.html#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># note that a, b, and c are all in transformed (log or logit) space</span></span>
<span id="cb5-37"><a href="xwalk.html#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-38"><a href="xwalk.html#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co"># this method increases an adjusted observation&#39;s uncertainty and effectively downweights it in subsequent analyses, like an ST-GPR model to estimate prevalence globally</span></span>
<span id="cb5-39"><a href="xwalk.html#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
</div>
<div id="ex2" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Example 2: one reference and multiple alternatives, with indirect comparisons</h2>
<p>Network meta-analysis is a method that allows the model to incorporate information from indirect comparisons. For example, in the case below, we have a gold standard diagnostic method A and two alternatives B and C. To adjust B and C observations to their predicted A-equivalents, the best input data we could give the meta-regression is many direct comparisons of B:A and C:A. However, B:C comparisons also help to inform the beta estimates for B:A and C:A, even if B:C is not the quantity of interest. In the example, we specify that the adjustment factor should vary by the level of a continuous covariate <code>x1</code>. By excluding intercepts, we ensure that the adjustment factor is 0 when the value of <code>x1</code> is 0.</p>
<p>Note that most network meta-analyses will want to include an intercept term in the list passed to <code>cov_models</code>. The model will return a coefficient for each definition that answers the question: here’s how much you need to adjust a reference observation to make it equivalent to the alternative definition. As described above, this is different than the guidance in GBD 2019 because the word “intercept” now refers to the <span class="math inline">\({-1,0,1}\)</span> variables that encode the network.</p>
<p>First, we create some simulated data. The column indicating which diagnostic is the reference (<code>refvar</code>) can include A, B and C. The column indicating the alternative diagnostic (<code>altvar</code>) includes only the alternatives, B and C. This means that both B and C can act as a “reference” for an indirect comparison, i.e. the order B:C or C:B doesn’t matter.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="xwalk.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb6-2"><a href="xwalk.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="xwalk.html#cb6-3" aria-hidden="true" tabindex="-1"></a>true_beta1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># define the true cofficient value for x1</span></span>
<span id="cb6-4"><a href="xwalk.html#cb6-4" aria-hidden="true" tabindex="-1"></a>case_defs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">B =</span> <span class="dv">2</span>, <span class="at">C =</span> <span class="dv">3</span>) <span class="co"># define case definitions and true coefficient values</span></span>
<span id="cb6-5"><a href="xwalk.html#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="xwalk.html#cb6-6" aria-hidden="true" tabindex="-1"></a>df_matched2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">400</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="xwalk.html#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-8"><a href="xwalk.html#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">altvar =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="fu">nrow</span>(.), <span class="cn">TRUE</span>),</span>
<span id="cb6-9"><a href="xwalk.html#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">refvar =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="fu">nrow</span>(.), <span class="cn">TRUE</span>),</span>
<span id="cb6-10"><a href="xwalk.html#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x1 =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>),</span>
<span id="cb6-11"><a href="xwalk.html#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.)),</span>
<span id="cb6-12"><a href="xwalk.html#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff =</span> logit_diff <span class="sc">+</span> (altvar <span class="sc">==</span> <span class="st">&quot;B&quot;</span>)<span class="sc">*</span>case_defs[<span class="st">&quot;B&quot;</span>] <span class="sc">*</span> x1<span class="sc">*</span>true_beta1,</span>
<span id="cb6-13"><a href="xwalk.html#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff =</span> logit_diff <span class="sc">+</span> (altvar <span class="sc">==</span> <span class="st">&quot;C&quot;</span>)<span class="sc">*</span>case_defs[<span class="st">&quot;C&quot;</span>] <span class="sc">*</span> x1<span class="sc">*</span>true_beta1,</span>
<span id="cb6-14"><a href="xwalk.html#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff =</span> logit_diff <span class="sc">-</span> (refvar <span class="sc">==</span> <span class="st">&quot;B&quot;</span>)<span class="sc">*</span>case_defs[<span class="st">&quot;B&quot;</span>] <span class="sc">*</span> x1<span class="sc">*</span>true_beta1,</span>
<span id="cb6-15"><a href="xwalk.html#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff =</span> logit_diff <span class="sc">-</span> (refvar <span class="sc">==</span> <span class="st">&quot;C&quot;</span>)<span class="sc">*</span>case_defs[<span class="st">&quot;C&quot;</span>] <span class="sc">*</span> x1<span class="sc">*</span>true_beta1,</span>
<span id="cb6-16"><a href="xwalk.html#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># logit_diff_se = runif(n = nrow(.), min = 0.4, max = 0.6),</span></span>
<span id="cb6-17"><a href="xwalk.html#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff_se =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="at">min =</span> <span class="fl">0.4</span>, <span class="at">max =</span> <span class="fl">0.6</span>),</span>
<span id="cb6-18"><a href="xwalk.html#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_id =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-19"><a href="xwalk.html#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(group_id) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="xwalk.html#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(altvar <span class="sc">!=</span> refvar) <span class="sc">%&gt;%</span></span>
<span id="cb6-21"><a href="xwalk.html#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(altvar, refvar, logit_diff, logit_diff_se, x1, group_id)</span>
<span id="cb6-22"><a href="xwalk.html#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="xwalk.html#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_matched2)</span>
<span id="cb6-24"><a href="xwalk.html#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   altvar refvar logit_diff logit_diff_se       x1 group_id</span></span>
<span id="cb6-25"><a href="xwalk.html#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      C      B   4.824921     0.5524550 5.394107        1</span></span>
<span id="cb6-26"><a href="xwalk.html#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      B      C  -3.309311     0.4719643 3.923313        1</span></span>
<span id="cb6-27"><a href="xwalk.html#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      C      B   4.035348     0.5238145 2.886901        1</span></span>
<span id="cb6-28"><a href="xwalk.html#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      B      A  18.119626     0.5445521 8.666537        1</span></span>
<span id="cb6-29"><a href="xwalk.html#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      C      B  10.743544     0.5142872 9.724320        1</span></span>
<span id="cb6-30"><a href="xwalk.html#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      C      A  24.837169     0.5588720 7.884719        1</span></span></code></pre></div>
<p>Next we specify the model the same way as in Example 1, with an important exception. We can give <code>CWModel()</code> a prior indicating whether one alternative should give a smaller adjustment than another, using the <code>order_prior</code> parameter. It takes a list of two-element vectors, with the first element indicating which diagnostic should have the lower crosswalk adjustment. <code>order_prior</code> is useful when one alternative definition is a subset of another. For example, if C is prevalence of current smokers and B is prevalence of daily smokers, B is a subset of C by definition. The default is not to include order priors.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="xwalk.html#cb7-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">CWData</span>(</span>
<span id="cb7-2"><a href="xwalk.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df_matched2,         <span class="co"># dataset for metaregression</span></span>
<span id="cb7-3"><a href="xwalk.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs =</span> <span class="st">&quot;logit_diff&quot;</span>,       <span class="co"># column name for the observation mean</span></span>
<span id="cb7-4"><a href="xwalk.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_se =</span> <span class="st">&quot;logit_diff_se&quot;</span>, <span class="co"># column name for the observation standard error</span></span>
<span id="cb7-5"><a href="xwalk.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">alt_dorms =</span> <span class="st">&quot;altvar&quot;</span>,     <span class="co"># column name of the variable indicating the alternative method</span></span>
<span id="cb7-6"><a href="xwalk.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_dorms =</span> <span class="st">&quot;refvar&quot;</span>,     <span class="co"># column name of the variable indicating the reference method</span></span>
<span id="cb7-7"><a href="xwalk.html#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">covs =</span> <span class="fu">list</span>(<span class="st">&quot;x1&quot;</span>),        <span class="co"># names of columns to be used as covariates later</span></span>
<span id="cb7-8"><a href="xwalk.html#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># covs = list(),        # names of columns to be used as covariates later</span></span>
<span id="cb7-9"><a href="xwalk.html#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">study_id =</span> <span class="st">&quot;group_id&quot;</span>     <span class="co"># name of the column indicating group membership, usually the matching groups</span></span>
<span id="cb7-10"><a href="xwalk.html#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="xwalk.html#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="xwalk.html#cb7-12" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">CWModel</span>(</span>
<span id="cb7-13"><a href="xwalk.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwdata =</span> df2,            <span class="co"># object returned by `CWData()`</span></span>
<span id="cb7-14"><a href="xwalk.html#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_type =</span> <span class="st">&quot;diff_logit&quot;</span>, <span class="co"># &quot;diff_log&quot; or &quot;diff_logit&quot; depending on whether bounds are [0, Inf) or [0, 1]</span></span>
<span id="cb7-15"><a href="xwalk.html#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov_models =</span> <span class="fu">list</span>(       <span class="co"># specying predictors in the model; see help(CovModel)</span></span>
<span id="cb7-16"><a href="xwalk.html#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CovModel(cov_name = &quot;intercept&quot;) ),</span></span>
<span id="cb7-17"><a href="xwalk.html#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CovModel</span>(<span class="at">cov_name =</span> <span class="st">&quot;x1&quot;</span>) ),</span>
<span id="cb7-18"><a href="xwalk.html#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">gold_dorm =</span> <span class="st">&quot;A&quot;</span>,   <span class="co"># the level of `ref_dorms` that indicates it&#39;s the gold standard</span></span>
<span id="cb7-19"><a href="xwalk.html#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_prior =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)) <span class="co"># tells the model that the coefficient estimated for B should be &lt;= the coefficient for C</span></span>
<span id="cb7-20"><a href="xwalk.html#cb7-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-21"><a href="xwalk.html#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="xwalk.html#cb7-22" aria-hidden="true" tabindex="-1"></a>fit2_tmp <span class="ot">&lt;-</span> <span class="fu">CWModel</span>(</span>
<span id="cb7-23"><a href="xwalk.html#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwdata =</span> df2,            <span class="co"># object returned by `CWData()`</span></span>
<span id="cb7-24"><a href="xwalk.html#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_type =</span> <span class="st">&quot;diff_logit&quot;</span>, <span class="co"># &quot;diff_log&quot; or &quot;diff_logit&quot; depending on whether bounds are [0, Inf) or [0, 1]</span></span>
<span id="cb7-25"><a href="xwalk.html#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov_models =</span> <span class="fu">list</span>(       <span class="co"># specying predictors in the model; see help(CovModel)</span></span>
<span id="cb7-26"><a href="xwalk.html#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CovModel(cov_name = &quot;intercept&quot;) ),</span></span>
<span id="cb7-27"><a href="xwalk.html#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CovModel</span>(<span class="at">cov_name =</span> <span class="st">&quot;x1&quot;</span>, <span class="at">spline =</span> <span class="fu">XSpline</span>(<span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">3.3</span>, <span class="fl">6.6</span>, <span class="dv">10</span>), <span class="at">degree =</span> 2L )) ),</span>
<span id="cb7-28"><a href="xwalk.html#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">gold_dorm =</span> <span class="st">&quot;A&quot;</span>,   <span class="co"># the level of `ref_dorms` that indicates it&#39;s the gold standard</span></span>
<span id="cb7-29"><a href="xwalk.html#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">order_prior =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)) <span class="co"># tells the model that the coefficient estimated for B should be &lt;= the coefficient for C</span></span>
<span id="cb7-30"><a href="xwalk.html#cb7-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-31"><a href="xwalk.html#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="xwalk.html#cb7-32" aria-hidden="true" tabindex="-1"></a>df_tmp <span class="ot">&lt;-</span> fit2<span class="sc">$</span><span class="fu">create_result_df</span>()</span>
<span id="cb7-33"><a href="xwalk.html#cb7-33" aria-hidden="true" tabindex="-1"></a>df_tmp2 <span class="ot">&lt;-</span> fit2_tmp<span class="sc">$</span><span class="fu">create_result_df</span>()</span>
<span id="cb7-34"><a href="xwalk.html#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="xwalk.html#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">data.frame</span>( <span class="co"># checking that the model recovers the true betas</span></span>
<span id="cb7-36"><a href="xwalk.html#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_true =</span> case_defs,</span>
<span id="cb7-37"><a href="xwalk.html#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_mean =</span> fit2<span class="sc">$</span>beta[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb7-38"><a href="xwalk.html#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta_se =</span> fit2<span class="sc">$</span>beta_sd[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb7-39"><a href="xwalk.html#cb7-39" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb7-40"><a href="xwalk.html#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   beta_true beta_mean     beta_se</span></span>
<span id="cb7-41"><a href="xwalk.html#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; B         2  2.000413 0.009301158</span></span>
<span id="cb7-42"><a href="xwalk.html#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; C         3  3.002995 0.009994177</span></span></code></pre></div>
<p>Finally, as before, we use the model to adjust biased observations in the original dataset.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="xwalk.html#cb8-1" aria-hidden="true" tabindex="-1"></a>df_orig2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">600</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="xwalk.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="xwalk.html#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanvar =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="at">min =</span> <span class="fl">0.2</span>, <span class="at">max =</span> <span class="fl">0.8</span>),</span>
<span id="cb8-4"><a href="xwalk.html#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdvar =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="at">min =</span> <span class="fl">0.4</span>, <span class="at">max =</span> <span class="fl">0.6</span>),</span>
<span id="cb8-5"><a href="xwalk.html#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x1 =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>),</span>
<span id="cb8-6"><a href="xwalk.html#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_id =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-7"><a href="xwalk.html#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb8-8"><a href="xwalk.html#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs_method =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), <span class="fu">nrow</span>(.), <span class="cn">TRUE</span>) )</span>
<span id="cb8-9"><a href="xwalk.html#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="xwalk.html#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_orig2)</span>
<span id="cb8-11"><a href="xwalk.html#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id   meanvar     sdvar       x1 group_id intercept obs_method</span></span>
<span id="cb8-12"><a href="xwalk.html#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1 0.5135624 0.5610527 8.169894       11         0          A</span></span>
<span id="cb8-13"><a href="xwalk.html#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2 0.6794278 0.5537111 7.596990       11         0          C</span></span>
<span id="cb8-14"><a href="xwalk.html#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  3 0.3244733 0.4681815 5.718239       20         0          C</span></span>
<span id="cb8-15"><a href="xwalk.html#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  4 0.4317691 0.5875787 9.887544        7         0          A</span></span>
<span id="cb8-16"><a href="xwalk.html#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  5 0.5254297 0.5007663 9.951715       14         0          C</span></span>
<span id="cb8-17"><a href="xwalk.html#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  6 0.6465518 0.4648555 3.214374       19         0          C</span></span>
<span id="cb8-18"><a href="xwalk.html#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="xwalk.html#cb8-19" aria-hidden="true" tabindex="-1"></a>preds2 <span class="ot">&lt;-</span> <span class="fu">adjust_orig_vals</span>(</span>
<span id="cb8-20"><a href="xwalk.html#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit_object =</span> fit2, <span class="co"># object returned by `CWModel()`</span></span>
<span id="cb8-21"><a href="xwalk.html#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df_orig2,</span>
<span id="cb8-22"><a href="xwalk.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_dorms =</span> <span class="st">&quot;obs_method&quot;</span>,</span>
<span id="cb8-23"><a href="xwalk.html#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_vals_mean =</span> <span class="st">&quot;meanvar&quot;</span>,</span>
<span id="cb8-24"><a href="xwalk.html#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_vals_se =</span> <span class="st">&quot;sdvar&quot;</span></span>
<span id="cb8-25"><a href="xwalk.html#cb8-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-26"><a href="xwalk.html#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="xwalk.html#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co"># now we add the adjusted values back to the original dataset</span></span>
<span id="cb8-28"><a href="xwalk.html#cb8-28" aria-hidden="true" tabindex="-1"></a>df_orig2[, <span class="fu">c</span>(</span>
<span id="cb8-29"><a href="xwalk.html#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;meanvar_adjusted&quot;</span>, <span class="st">&quot;sdvar_adjusted&quot;</span>, <span class="st">&quot;pred_logit&quot;</span>, </span>
<span id="cb8-30"><a href="xwalk.html#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;pred_se_logit&quot;</span>, <span class="st">&quot;data_id&quot;</span>)] <span class="ot">&lt;-</span> preds2</span>
<span id="cb8-31"><a href="xwalk.html#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="xwalk.html#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># note that the gold standard observations remain untouched</span></span>
<span id="cb8-33"><a href="xwalk.html#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_orig2)</span>
<span id="cb8-34"><a href="xwalk.html#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id   meanvar     sdvar       x1 group_id intercept obs_method</span></span>
<span id="cb8-35"><a href="xwalk.html#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1 0.5135624 0.5610527 8.169894       11         0          A</span></span>
<span id="cb8-36"><a href="xwalk.html#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2 0.6794278 0.5537111 7.596990       11         0          C</span></span>
<span id="cb8-37"><a href="xwalk.html#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  3 0.3244733 0.4681815 5.718239       20         0          C</span></span>
<span id="cb8-38"><a href="xwalk.html#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  4 0.4317691 0.5875787 9.887544        7         0          A</span></span>
<span id="cb8-39"><a href="xwalk.html#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  5 0.5254297 0.5007663 9.951715       14         0          C</span></span>
<span id="cb8-40"><a href="xwalk.html#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  6 0.6465518 0.4648555 3.214374       19         0          C</span></span>
<span id="cb8-41"><a href="xwalk.html#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   meanvar_adjusted sdvar_adjusted pred_logit pred_se_logit data_id</span></span>
<span id="cb8-42"><a href="xwalk.html#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     5.135624e-01   5.611872e-01   0.000000    0.00000000       0</span></span>
<span id="cb8-43"><a href="xwalk.html#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2.620254e-10   6.665493e-10  22.813723    0.07592566       1</span></span>
<span id="cb8-44"><a href="xwalk.html#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     1.674553e-08   3.579003e-08  17.171845    0.05714910       2</span></span>
<span id="cb8-45"><a href="xwalk.html#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4.317691e-01   5.877026e-01   0.000000    0.00000000       3</span></span>
<span id="cb8-46"><a href="xwalk.html#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     1.162370e-13   2.337901e-13  29.884952    0.09945921       4</span></span>
<span id="cb8-47"><a href="xwalk.html#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     1.175142e-04   2.391163e-04   9.652751    0.03212503       5</span></span></code></pre></div>
</div>
<div id="ex3" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Example 3: one reference and multiple alternatives; alternatives composed of sub-definitions</h2>
<p>Sometimes alternative definitions are not mutually exclusive. For example, maybe the gold standard way to measure prevalence is with diagnostic tool A and among the general population. However, some observations measured prevalence with diagnostic tool B and/or only in urban populations (C). In addition to using the non-standard diagnostic tool in the general population (denoted as “B”), alternative observations can take on values of “C” or “B_C” if the prevalence was measured in an urban population. We account for this in a crosswalk adjustment by assuming additivity of the sub-definitions, i.e. the logit-space adjustment due to taking prevalence in an urban population is the same regardless of which diagnostic tool was used. As in Example 2, we relax the requirement that prevalence comparisons must include the gold-standard reference. Network meta-analysis allows the model to take advantage of comparisons between two alternative definitions, e.g. “B” and “B_C.”</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="xwalk.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb9-2"><a href="xwalk.html#cb9-2" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">400</span>)</span>
<span id="cb9-3"><a href="xwalk.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="xwalk.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb9-5"><a href="xwalk.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create the simulated dataset</span></span>
<span id="cb9-6"><a href="xwalk.html#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="xwalk.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define case definitions and coefficients for simulation</span></span>
<span id="cb9-8"><a href="xwalk.html#cb9-8" aria-hidden="true" tabindex="-1"></a>case_defs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">B =</span> <span class="dv">2</span>, <span class="at">C =</span> <span class="dv">3</span>)</span>
<span id="cb9-9"><a href="xwalk.html#cb9-9" aria-hidden="true" tabindex="-1"></a>n_sample_defs <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb9-10"><a href="xwalk.html#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="xwalk.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly sample from case definition components to make combined case definitions</span></span>
<span id="cb9-12"><a href="xwalk.html#cb9-12" aria-hidden="true" tabindex="-1"></a>df3<span class="sc">$</span>alt <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df3), <span class="cf">function</span>(i) {</span>
<span id="cb9-13"><a href="xwalk.html#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">names</span>(case_defs), <span class="at">size =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n_sample_defs))), <span class="at">collapse =</span> <span class="st">&#39;_&#39;</span>)</span>
<span id="cb9-14"><a href="xwalk.html#cb9-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-15"><a href="xwalk.html#cb9-15" aria-hidden="true" tabindex="-1"></a>df3<span class="sc">$</span>ref <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df3), <span class="cf">function</span>(i) {</span>
<span id="cb9-16"><a href="xwalk.html#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">names</span>(case_defs), <span class="at">size =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n_sample_defs))), <span class="at">collapse =</span> <span class="st">&#39;_&#39;</span>)</span>
<span id="cb9-17"><a href="xwalk.html#cb9-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-18"><a href="xwalk.html#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="xwalk.html#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># make half of the reference case definitions &#39;A&#39; to signify the gold standard</span></span>
<span id="cb9-20"><a href="xwalk.html#cb9-20" aria-hidden="true" tabindex="-1"></a>df3<span class="sc">$</span>ref <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df3<span class="sc">$</span>id <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;A&quot;</span>, df3<span class="sc">$</span>ref)</span>
<span id="cb9-21"><a href="xwalk.html#cb9-21" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">filter</span>(df3, ref <span class="sc">!=</span> alt) <span class="co"># remove duplicates</span></span>
<span id="cb9-22"><a href="xwalk.html#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="xwalk.html#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># subtract coefficient if component is in the reference def, and </span></span>
<span id="cb9-24"><a href="xwalk.html#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># add coefficient if component is in the alternative def</span></span>
<span id="cb9-25"><a href="xwalk.html#cb9-25" aria-hidden="true" tabindex="-1"></a>df4<span class="sc">$</span>logit_prev_diff <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-26"><a href="xwalk.html#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(case_defs)) df4<span class="sc">$</span>logit_prev_diff <span class="ot">&lt;-</span> df4<span class="sc">$</span>logit_prev_diff <span class="sc">-</span> (<span class="fu">sapply</span>(i, grepl, df4<span class="sc">$</span>ref) <span class="sc">*</span> case_defs[i])</span>
<span id="cb9-27"><a href="xwalk.html#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(case_defs)) df4<span class="sc">$</span>logit_prev_diff <span class="ot">&lt;-</span> df4<span class="sc">$</span>logit_prev_diff <span class="sc">+</span> (<span class="fu">sapply</span>(i, grepl, df4<span class="sc">$</span>alt) <span class="sc">*</span> case_defs[i])</span>
<span id="cb9-28"><a href="xwalk.html#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="xwalk.html#cb9-29" aria-hidden="true" tabindex="-1"></a>df4<span class="sc">$</span>logit_prev_diff <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df4<span class="sc">$</span>logit_prev_diff <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">nrow</span>(df4), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>))</span>
<span id="cb9-30"><a href="xwalk.html#cb9-30" aria-hidden="true" tabindex="-1"></a>df4<span class="sc">$</span>logit_prev_diff_se <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb9-31"><a href="xwalk.html#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="xwalk.html#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df4)</span>
<span id="cb9-33"><a href="xwalk.html#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id alt ref logit_prev_diff logit_prev_diff_se</span></span>
<span id="cb9-34"><a href="xwalk.html#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1   B B_C       -1.095623                0.5</span></span>
<span id="cb9-35"><a href="xwalk.html#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2   B   A        1.651368                0.5</span></span>
<span id="cb9-36"><a href="xwalk.html#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  3   C   B        1.218831                0.5</span></span>
<span id="cb9-37"><a href="xwalk.html#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  4 B_C   A        6.144955                0.5</span></span>
<span id="cb9-38"><a href="xwalk.html#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  5   C B_C       -2.123546                0.5</span></span>
<span id="cb9-39"><a href="xwalk.html#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  6 B_C   A        5.147393                0.5</span></span></code></pre></div>
<p>To use composite definitions – alternative definitions with non-mutually exclusive sub-definitions – we include a delimiter in the values we pass to the <code>alt_dorms</code> and <code>ref_dorms</code> columns. If the delimiter is "_" as in this example, we pass it as an argument to the <code>dorm_separator</code> parameter of <code>CWData()</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="xwalk.html#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="xwalk.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb10-3"><a href="xwalk.html#cb10-3" aria-hidden="true" tabindex="-1"></a>dat4 <span class="ot">&lt;-</span> <span class="fu">CWData</span>(</span>
<span id="cb10-4"><a href="xwalk.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df4,</span>
<span id="cb10-5"><a href="xwalk.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs =</span> <span class="st">&quot;logit_prev_diff&quot;</span>,</span>
<span id="cb10-6"><a href="xwalk.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_se =</span> <span class="st">&quot;logit_prev_diff_se&quot;</span>,</span>
<span id="cb10-7"><a href="xwalk.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">alt_dorms =</span> <span class="st">&quot;alt&quot;</span>,</span>
<span id="cb10-8"><a href="xwalk.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_dorms =</span> <span class="st">&quot;ref&quot;</span>,</span>
<span id="cb10-9"><a href="xwalk.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dorm_separator =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb10-10"><a href="xwalk.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">covs =</span> <span class="fu">list</span>(),</span>
<span id="cb10-11"><a href="xwalk.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">study_id =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb10-12"><a href="xwalk.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_intercept =</span> <span class="cn">TRUE</span></span>
<span id="cb10-13"><a href="xwalk.html#cb10-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-14"><a href="xwalk.html#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="xwalk.html#cb10-15" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> <span class="fu">CWModel</span>(</span>
<span id="cb10-16"><a href="xwalk.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwdata =</span> dat4,</span>
<span id="cb10-17"><a href="xwalk.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_type =</span> <span class="st">&quot;diff_logit&quot;</span>,</span>
<span id="cb10-18"><a href="xwalk.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov_models =</span> <span class="fu">list</span>(<span class="fu">CovModel</span>(<span class="st">&quot;intercept&quot;</span>)),</span>
<span id="cb10-19"><a href="xwalk.html#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # we can put priors on the beta for a specific alternative definition:</span></span>
<span id="cb10-20"><a href="xwalk.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cov_models = list(CovModel(&quot;intercept&quot;, prior_beta_uniform = list(B = array(c(0,0))))),</span></span>
<span id="cb10-21"><a href="xwalk.html#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">gold_dorm =</span> <span class="st">&quot;A&quot;</span></span>
<span id="cb10-22"><a href="xwalk.html#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prior_gamma_uniform = array(c(0, 0.4))</span></span>
<span id="cb10-23"><a href="xwalk.html#cb10-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-24"><a href="xwalk.html#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="xwalk.html#cb10-25" aria-hidden="true" tabindex="-1"></a>fit4<span class="sc">$</span>fixed_vars</span>
<span id="cb10-26"><a href="xwalk.html#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $A</span></span>
<span id="cb10-27"><a href="xwalk.html#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb10-28"><a href="xwalk.html#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-29"><a href="xwalk.html#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $B</span></span>
<span id="cb10-30"><a href="xwalk.html#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2.002939</span></span>
<span id="cb10-31"><a href="xwalk.html#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb10-32"><a href="xwalk.html#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $C</span></span>
<span id="cb10-33"><a href="xwalk.html#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3.033783</span></span>
<span id="cb10-34"><a href="xwalk.html#cb10-34" aria-hidden="true" tabindex="-1"></a>case_defs</span>
<span id="cb10-35"><a href="xwalk.html#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; B C </span></span>
<span id="cb10-36"><a href="xwalk.html#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 3</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="xwalk.html#cb11-1" aria-hidden="true" tabindex="-1"></a>df_orig4 <span class="ot">&lt;-</span> df4 <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="xwalk.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="xwalk.html#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">prev_orig =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="fu">nrow</span>(.), <span class="fl">0.1</span>, <span class="fl">0.9</span>),</span>
<span id="cb11-4"><a href="xwalk.html#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prev_orig_se =</span> <span class="fl">0.2</span>,</span>
<span id="cb11-5"><a href="xwalk.html#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">meas_method =</span> ref) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="xwalk.html#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ref, <span class="sc">-</span>alt, <span class="sc">-</span>logit_prev_diff, <span class="sc">-</span>logit_prev_diff_se)</span>
<span id="cb11-7"><a href="xwalk.html#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="xwalk.html#cb11-8" aria-hidden="true" tabindex="-1"></a>preds4 <span class="ot">&lt;-</span> <span class="fu">adjust_orig_vals</span>(</span>
<span id="cb11-9"><a href="xwalk.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit_object =</span> fit4, <span class="co"># object returned by `CWModel()`</span></span>
<span id="cb11-10"><a href="xwalk.html#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df_orig4,</span>
<span id="cb11-11"><a href="xwalk.html#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_dorms =</span> <span class="st">&quot;meas_method&quot;</span>,</span>
<span id="cb11-12"><a href="xwalk.html#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_vals_mean =</span> <span class="st">&quot;prev_orig&quot;</span>,</span>
<span id="cb11-13"><a href="xwalk.html#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">orig_vals_se =</span> <span class="st">&quot;prev_orig_se&quot;</span></span>
<span id="cb11-14"><a href="xwalk.html#cb11-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-15"><a href="xwalk.html#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="xwalk.html#cb11-16" aria-hidden="true" tabindex="-1"></a>df_orig4[, <span class="fu">c</span>(<span class="st">&quot;prev_adjusted&quot;</span>, <span class="st">&quot;prev_se_adjusted&quot;</span>, <span class="st">&quot;prediction_logit&quot;</span>, </span>
<span id="cb11-17"><a href="xwalk.html#cb11-17" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;prediction_se_logit&quot;</span>, <span class="st">&quot;data_id&quot;</span>)] <span class="ot">&lt;-</span> preds4</span>
<span id="cb11-18"><a href="xwalk.html#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="xwalk.html#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_orig4)</span>
<span id="cb11-20"><a href="xwalk.html#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id prev_orig prev_orig_se meas_method prev_adjusted prev_se_adjusted</span></span>
<span id="cb11-21"><a href="xwalk.html#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1 0.6294998          0.2         B_C    0.01091491       0.01325531</span></span>
<span id="cb11-22"><a href="xwalk.html#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2 0.1380010          0.2           A    0.13800096       0.22532907</span></span>
<span id="cb11-23"><a href="xwalk.html#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  3 0.8047976          0.2           B    0.35746479       0.35488945</span></span>
<span id="cb11-24"><a href="xwalk.html#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  4 0.8455840          0.2           A    0.84558400       0.23017319</span></span>
<span id="cb11-25"><a href="xwalk.html#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  5 0.8639310          0.2         B_C    0.03960492       0.07283514</span></span>
<span id="cb11-26"><a href="xwalk.html#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  6 0.7042963          0.2           A    0.70429629       0.27022408</span></span>
<span id="cb11-27"><a href="xwalk.html#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   prediction_logit prediction_se_logit data_id</span></span>
<span id="cb11-28"><a href="xwalk.html#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1         5.036722          0.10433740       0</span></span>
<span id="cb11-29"><a href="xwalk.html#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2         0.000000          0.00000000       1</span></span>
<span id="cb11-30"><a href="xwalk.html#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3         2.002939          0.07302781       2</span></span>
<span id="cb11-31"><a href="xwalk.html#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4         0.000000          0.00000000       3</span></span>
<span id="cb11-32"><a href="xwalk.html#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5         5.036722          0.10433740       4</span></span>
<span id="cb11-33"><a href="xwalk.html#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6         0.000000          0.00000000       5</span></span></code></pre></div>
</div>
<div id="ex4" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Funnel plots and dose-response plots</h2>
<p>To assess the fit of a crosswalk model, we use a funnel plot to see how well a single crosswalk coefficient describes the data. When the crosswalk adjustment varies by levels of a continuous variable, we use a dose-response plot. First, to enable the use of the <code>matplotlib</code> library in the underlying Python code, we run <code>repl_python()</code> to open an interactive Python interpreter, then type <code>exit</code> in the console to return to the R interpreter. (We’re still figuring out why this is necessary and will fix it when we do!)</p>
<p>If any covariates were included in the meta-regression model, the <code>plots$funnel_plot()</code> and <code>plots$dose_response_curve()</code> functions assume a covariate value of zero unless otherwise specified by the <code>continuous_variables</code> parameter. The prediction will be based upon the median value observed in the input data for all variables names passed to <code>continuous_variables</code>. <code>obs_method</code> indicates which alternative definition/method (dorm) should be visualized, compared to the gold standard reference. This parameter should be specified regardless of whether or not there are multiple alternative definitions.</p>
<p>PDFs of the plots are saved in the location passed to <code>plots_dir</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="xwalk.html#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="xwalk.html#cb12-2" aria-hidden="true" tabindex="-1"></a>df_matched5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="xwalk.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-4"><a href="xwalk.html#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff_se =</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(.), <span class="fl">0.5</span>, <span class="dv">10</span>),</span>
<span id="cb12-5"><a href="xwalk.html#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">logit_diff =</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="dv">0</span>, logit_diff_se),</span>
<span id="cb12-6"><a href="xwalk.html#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">altvar =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">%%</span> <span class="dv">8</span> <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;awefawef&quot;</span>, <span class="st">&quot;selfreported&quot;</span>),</span>
<span id="cb12-7"><a href="xwalk.html#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">refvar =</span> <span class="st">&quot;measured&quot;</span>,</span>
<span id="cb12-8"><a href="xwalk.html#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">each =</span> <span class="dv">20</span>)</span>
<span id="cb12-9"><a href="xwalk.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-10"><a href="xwalk.html#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="xwalk.html#cb12-11" aria-hidden="true" tabindex="-1"></a>dat5 <span class="ot">&lt;-</span> <span class="fu">CWData</span>(</span>
<span id="cb12-12"><a href="xwalk.html#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> df_matched5,</span>
<span id="cb12-13"><a href="xwalk.html#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs =</span> <span class="st">&quot;logit_diff&quot;</span>,</span>
<span id="cb12-14"><a href="xwalk.html#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_se =</span> <span class="st">&quot;logit_diff_se&quot;</span>,</span>
<span id="cb12-15"><a href="xwalk.html#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">alt_dorms =</span> <span class="st">&quot;altvar&quot;</span>,</span>
<span id="cb12-16"><a href="xwalk.html#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_dorms =</span> <span class="st">&quot;refvar&quot;</span>,</span>
<span id="cb12-17"><a href="xwalk.html#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">covs =</span> <span class="fu">list</span>(),</span>
<span id="cb12-18"><a href="xwalk.html#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">study_id =</span> <span class="st">&quot;group_id&quot;</span>,</span>
<span id="cb12-19"><a href="xwalk.html#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">add_intercept =</span> <span class="cn">TRUE</span></span>
<span id="cb12-20"><a href="xwalk.html#cb12-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-21"><a href="xwalk.html#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="xwalk.html#cb12-22" aria-hidden="true" tabindex="-1"></a>fit5 <span class="ot">&lt;-</span> <span class="fu">CWModel</span>(</span>
<span id="cb12-23"><a href="xwalk.html#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwdata =</span> dat5,</span>
<span id="cb12-24"><a href="xwalk.html#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_type =</span> <span class="st">&quot;diff_logit&quot;</span>,</span>
<span id="cb12-25"><a href="xwalk.html#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cov_models =</span> <span class="fu">list</span>(</span>
<span id="cb12-26"><a href="xwalk.html#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">CovModel</span>(<span class="at">cov_name =</span> <span class="st">&quot;intercept&quot;</span>) ),</span>
<span id="cb12-27"><a href="xwalk.html#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">gold_dorm =</span> <span class="st">&quot;measured&quot;</span>,</span>
<span id="cb12-28"><a href="xwalk.html#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">inlier_pct =</span> <span class="fl">0.9</span></span>
<span id="cb12-29"><a href="xwalk.html#cb12-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-30"><a href="xwalk.html#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="xwalk.html#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="do">##### don&#39;t forget to run repl_python() !</span></span>
<span id="cb12-32"><a href="xwalk.html#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ... then type &#39;exit&#39; to get back to the R interpreter</span></span>
<span id="cb12-33"><a href="xwalk.html#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="fu">repl_python</span>()</span>
<span id="cb12-34"><a href="xwalk.html#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="xwalk.html#cb12-35" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;crosswalk.plots&quot;</span>)</span>
<span id="cb12-36"><a href="xwalk.html#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="xwalk.html#cb12-37" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span><span class="fu">funnel_plot</span>(</span>
<span id="cb12-38"><a href="xwalk.html#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwmodel =</span> fit5, </span>
<span id="cb12-39"><a href="xwalk.html#cb12-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwdata =</span> dat5,</span>
<span id="cb12-40"><a href="xwalk.html#cb12-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">continuous_variables =</span> <span class="fu">list</span>(),</span>
<span id="cb12-41"><a href="xwalk.html#cb12-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_method =</span> <span class="st">&#39;selfreported&#39;</span>,</span>
<span id="cb12-42"><a href="xwalk.html#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_note =</span> <span class="st">&#39;Funnel plot example&#39;</span>, </span>
<span id="cb12-43"><a href="xwalk.html#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">plots_dir =</span> <span class="st">&#39;/home/j/temp/reed/misc/&#39;</span>, </span>
<span id="cb12-44"><a href="xwalk.html#cb12-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_name =</span> <span class="st">&quot;funny_plot_example_v10&quot;</span>,</span>
<span id="cb12-45"><a href="xwalk.html#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">write_file =</span> <span class="cn">TRUE</span></span>
<span id="cb12-46"><a href="xwalk.html#cb12-46" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>For the dose-response plot, the variable given to <code>dose_variable</code> will be on the x-axis.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="xwalk.html#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="xwalk.html#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="xwalk.html#cb13-3" aria-hidden="true" tabindex="-1"></a>plots<span class="sc">$</span><span class="fu">dose_response_curve</span>(</span>
<span id="cb13-4"><a href="xwalk.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose_variable =</span> <span class="st">&#39;x1&#39;</span>,</span>
<span id="cb13-5"><a href="xwalk.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_method =</span> <span class="st">&#39;B&#39;</span>, </span>
<span id="cb13-6"><a href="xwalk.html#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">continuous_variables=</span><span class="fu">list</span>(), </span>
<span id="cb13-7"><a href="xwalk.html#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwdata=</span>df2, </span>
<span id="cb13-8"><a href="xwalk.html#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cwmodel=</span>fit2, </span>
<span id="cb13-9"><a href="xwalk.html#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot_note=</span><span class="st">&quot;Example dose-response plot&quot;</span>, </span>
<span id="cb13-10"><a href="xwalk.html#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">plots_dir=</span><span class="st">&#39;/home/j/temp/reed/misc/&#39;</span>, </span>
<span id="cb13-11"><a href="xwalk.html#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_name =</span> <span class="st">&quot;doseresponse_plot_example_v7&quot;</span>, </span>
<span id="cb13-12"><a href="xwalk.html#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">write_file=</span><span class="cn">TRUE</span>)</span>
<span id="cb13-13"><a href="xwalk.html#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="xwalk.html#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="xwalk.html#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># py_run_string(&quot;import importlib; importlib.reload(plots)&quot;)</span></span>
<span id="cb13-16"><a href="xwalk.html#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># importlib &lt;- import(&quot;importlib&quot;)</span></span>
<span id="cb13-17"><a href="xwalk.html#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># plots &lt;- importlib$reload(plots)</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mrbrt.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-crosswalk.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
